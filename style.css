const SB_URL = "https://mycldrtubwstojeaumcg.supabase.co"; 
const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15Y2xkcnR1YndzdG9qZWF1bWNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyNzQwNTksImV4cCI6MjA4NTg1MDA1OX0.GHgglJHGQqDDRY-IcvhQeZyYZmR48J3arnby8IxZo9I";
const supabaseClient = supabase.createClient(SB_URL, SB_KEY);

function updateClock() {
    const now = new Date();
    document.getElementById('clock').innerText = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
    document.getElementById('cal-month').innerText = now.toLocaleDateString('id-ID', { month: 'short' });
    document.getElementById('cal-date').innerText = now.getDate();
    document.getElementById('cal-day').innerText = now.toLocaleDateString('id-ID', { weekday: 'long' });
}

async function muatData() {
    let { data, error } = await supabaseClient.from('schedule').select('*').order('id', { ascending: false });
    if (!error) {
        const list = document.getElementById('listData');
        if (data.length === 0) {
            list.innerHTML = "<p class='text-center text-slate-400 py-20'>Belum ada informasi.</p>";
            return;
        }
        list.innerHTML = data.map(item => `
            <div class="bg-white/40 border border-white/50 p-5 rounded-[1.8rem] flex justify-between items-start group">
                <div>
                    <span class="text-[10px] font-bold px-3 py-1 bg-white/80 text-blue-600 rounded-full uppercase">${item.category}</span>
                    <p class="mt-3 text-slate-800 font-medium text-lg">${item.content}</p>
                </div>
                <button onclick="hapusData(${item.id})" class="text-slate-300 hover:text-red-500 transition-colors">âœ•</button>
            </div>
        `).join('');
    }
}

async function simpanData() {
    const teks = document.getElementById('isiData').value;
    if(!teks) return alert("Isi data dulu!");
    await supabaseClient.from('schedule').insert([{ 
        category: document.getElementById('kategori').value, 
        content: teks 
    }]);
    document.getElementById('isiData').value = '';
    muatData();
}

async function hapusData(id) {
    if(confirm("Hapus data ini?")) {
        await supabaseClient.from('schedule').delete().eq('id', id);
        muatData();
    }
}

setInterval(updateClock, 1000);
updateClock();
muatData();
setInterval(muatData, 15000);
